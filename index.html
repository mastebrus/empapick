<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <title>Empa-Pick</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="normalize.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Chakra+Petch&family=Montserrat:wght@400;500&family=Orbitron:wght@400;600;900&family=Roboto+Mono&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script
      src="https://kit.fontawesome.com/270cc5acdb.js"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <header id="header">
      <h1>EMPA-PICK</h1>
      <h4>choose your empanadas with friends</h4>
      <!--descripcion de la app-->
    </header>
    <main>
      <section id="pantalla-1" style="border: solid 1px white">
        <!--pantalla 1-->
        <div class="pregunta">
          <p>Cuantos gorditos van a pedir?</p>
          <!-- cantidad de comensales-->
          <div>
            <button class="menos" type="button" onClick="restar(this)">
              <i class="fa-solid fa-minus"></i></button
            ><input
              id="comensales"
              class="number"
              type="number"
              value="1"
              readonly="readonly"
            /><button class="mas" type="button" onClick="sumar(this)">
              <i class="fa-solid fa-plus"></i>
            </button>
          </div>
        </div>
        <div class="pregunta">
          <p class="minimo">Según el lugar donde van a pedir, ingrese</p>
          <p>valor de cada empanada</p>
          <!-- valor de cada empanada-->
          <div>
            <span>$ </span
            ><input
              class="number precio"
              type="number"
              id="comensales2"
            /><span></span>
          </div>
        </div>
        <div>
          <button class="button-sig" onClick="getVals(this)">Siguiente</button>
        </div>
      </section>
      <section id="seleccion" style="border: solid 1px white">
        <!--pantalla 2 / seleccion-->
        <h3></h3>
        <!-- instrucciones -->
        <label for="nombre"
          ><input
            id="nombre"
            placeholder="Nombre:"
            name="nombre"
            class="nombre empanada"
        /></label>
        <ul>
          <li>
            <label for="carne-suave" class="empanada">Carne suave</label
            ><button class="menos" type="button" onClick="restar(this)">
              -</button
            ><input
              class="number empanada"
              name="carne-suave"
              type="number"
              value="0"
            /><button class="mas" type="button" onClick="sumar(this)">+</button>
          </li>

          <li>
            <label for="" class="empanada">Carne cortada a cuchillo</label
            ><button class="menos" type="button" onClick="restar(this)">
              -</button
            ><input
              class="number empanada"
              name="carne-cortada"
              type="number"
              value="0"
            /><button class="mas" type="button" onClick="sumar(this)">+</button>
          </li>

          <li>
            <label for="" class="empanada">Carne picante</label
            ><button type="button" class="menos" onClick="restar(this)">
              -</button
            ><input
              class="number empanada"
              name="carne-picante"
              type="number"
              value="0"
            /><button class="mas" type="button" onClick="sumar(this)">+</button>
          </li>

          <li>
            <label for="" class="empanada">Pollo</label
            ><button type="button" class="menos" onClick="restar(this)">
              -</button
            ><input
              class="number empanada"
              name="pollo"
              type="number"
              value="0"
            /><button class="mas" type="button" onClick="sumar(this)">+</button>
          </li>

          <li>
            <label for="" class="empanada">Pollo al verdeo</label
            ><button type="button" class="menos" onClick="restar(this)">
              -</button
            ><input
              class="number empanada"
              name="pollo-verdeo"
              type="number"
              value="0"
            /><button class="mas" type="button" onClick="sumar(this)">+</button>
          </li>

          <li>
            <label for="" class="empanada">Jamón y queso</label
            ><button type="button" class="menos" onClick="restar(this)">
              -</button
            ><input
              class="number empanada"
              name="carne-suave"
              type="number"
              value="0"
            /><button class="mas" type="button" onClick="sumar(this)">+</button>
          </li>
          <!--custom-->
        </ul>
        <button id="button-seleccion" class="button-sig" onClick="siguiente()">
          Siguiente
        </button>
      </section>
      <section id="resumen"><!--pantalla 3 / resumen--></section>
    </main>
  </body>
  <script type="text/javascript">
    let pedidoTotal = [];
    let valores = [];
    var inputs,
      index,
      vueltas = 0;

    inputs = document.getElementsByClassName("empanada");

    //const comensales = document.getElementById('comensales').value;
    //comensales.addEventListener("change",(event)=>{
    //    console.log(event);
    //const result=true});

    function sumar(el) {
      var cant = el.previousSibling.valueAsNumber;
      cant = cant + 1;
      el.previousSibling.valueAsNumber = cant;
    }
    function restar(el) {
      if (el.nextSibling.valueAsNumber < 1) {
        return;
      } else {
        el.nextSibling.valueAsNumber = el.nextSibling.valueAsNumber - 1;
      }
    }
    function Empanada(nombre, cantidad) {
      this.nombre = nombre;
      this.cantidad = cantidad;
    }
    function PedidoComensal(nombre, empanadas) {
      this.nombre = nombre;
      this.empanadas = [empanadas];
    }
    function contador(inputs) {
      var index;
      let contador = 0;
      let empanadas = [];
      const pedidoComensal = new PedidoComensal(null, []);
      var empanada = new Empanada(null, 0);

      pedidoComensal.nombre = inputs[0].value;
      for (index = 1; index < inputs.length; ++index) {
        if (index % 2 == 0) {
          if (inputs[index].value != 0) {
            empanada.cantidad = inputs[index].value;
            empanadas.push(empanada);
          }
          contador += 1;
        } else {
          empanada.nombre = inputs[index].innerText;
          contador += 1;
        }
        if (contador == 2) {
          var empanada = new Empanada(null, 0);
          contador = 0;
        }
      }
      pedidoComensal.empanadas = empanadas;
      pedidoTotal.push(pedidoComensal);
    }

    function siguiente() {
      var index;
      inputs = document.getElementsByClassName("empanada");
      contador(inputs);
      vueltas += 1;
      for (index = 0; index < inputs.length; ++index) {
        if (inputs[index].type == "number") {
          inputs[index].value = 0;
        } else {
          inputs[index].value = null;
        }
      }
      if (vueltas == valores[0]) {
        setFinalizar();
      }
    }
    function setFinalizar() {
      var boton = document.getElementById("button-seleccion");
      boton.innerText = "Finalizar";
      boton.attributes.onclick.value = "informarTotales()";
    }

    function getVals(el) {
      valores[0] = document.getElementById("comensales").value;
      valores[1] = document.getElementById("comensales2").value;
      document.getElementById("seleccion").style.display = "flex";
      document.getElementById("pantalla-1").style.display = "none";
      document.getElementById("header").style.height = "100px";
    }

    function informarTotales() {
      let total_Empas = 0;

      console.log("informa los totales");
      console.log(pedidoTotal);

      var div = document.createElement("div");

      pedidoTotal.forEach((pedido) => {
        var divComensal = document.createElement("div");
        divComensal.classList.add("comensal");
        var nombreComensal = document.createElement("label");
        nombreComensal.innerText = pedido.nombre;
        divComensal.appendChild(nombreComensal);
        var valor_comensal = document.createElement("input");
        let total_Comensal = 0;
        pedido.empanadas.forEach((p) => {
          total_Empas += p.cantidad * valores[1];
          total_Comensal += p.cantidad * valores[1];

          valor_comensal.value = total_Comensal;
          ("");
          divComensal.appendChild(valor_comensal);
          div.appendChild(divComensal);
        });
      });
      document.getElementById("seleccion").style.display = "none";

      var valor_total = document.createElement("label");
      var input_total = document.createElement("input");
      valor_total.innerText = "Total";
      input_total.value = total_Empas;
      div.appendChild(valor_total);
      div.appendChild(input_total);
      document.getElementById("resumen").appendChild(div);

      return;
    }
  </script>
</html>
